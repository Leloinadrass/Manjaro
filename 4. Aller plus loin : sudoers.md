On rencontre un souci avec le tuto jusqu'à présent, c'est que régulièrement les utilisateurs vont télécharger des jeux, des mises à jour, 
dans le point de montage `/mnt/steam` et donc il faut s'assurer que le propriétaire de tous ces fichiers est "user1:SteamGroup".

Problème, la commande `sudo chown -R user1:SteamGroup /mnt/steam/SteamLibrary ` est une commande à privilèges élevés, 
donc on ne peut pas la mettre simplement dans un script dans soucis.

On va donc éditer le fichier "sudoers" pour permettre l'exécution de cette commande, et uniquement de cette commande, sans avoir besoin de saisir le mot de passe.

1. Créons un script car Vim a beaucoup de mal avec une commande qui inclut le ":".
```
sudo nano /usr/local/bin/chown-steam
```
Ce script va aller dans un dossier qui ne dépend pas de l'utilisateur, ainsi on pourra facilement l'ajouter aux scripts des différents utilisateurs sans prise de tête.

Dans le script, on met :
```
#!/bin/bash
/usr/bin/chown -R melgrin:SteamGroup /mnt/steam/SteamLibrary
```
et on le rend exécutable :
```
sudo chmod +x /usr/local/bin/chown-steam
```


2. Ouvre l’éditeur de configuration sudoers
``` 
sudo visudo
```
**Attention**
éditer le fichier Sudoers est risqué, plus que ce qui précède. Il faut faire très attention.

3. Ajoute une règle au fichier `sudoers` On peut ajouter une ligne comme celle-ci à la fin du fichier :

```

%SteamGroup ALL=(ALL) NOPASSWD: /usr/local/bin/chown-steam

```

On est dans VIM, et ce n'est pas intuitif du tout. Quelques rappels peuvent être utiles :
Par défaut on est en mode commande : on peut utiliser les touches fléchées pour se déplacer dans le fichier.

`i` : passe en mode édition
`esc` : quitte le mode édition et repasse en mode commande
`dd` : supprime la ligne entière (il n'y a que comme ça qu'on peut supprimer des lignes. Backspace ou SUppr en mode édition sur une ligne vide ne font rien.)
`x` : supprime le caractère sur lequel se trouve le curseur
`:wq` : Write and Quit (Sauvegarde et quitte). Vim va vérifier la syntaxe. Si jamais il trouve une erreur, il faut saisir `e` pour rééditer le fichier.
`:q!` : quitte Vim sans sauvegarder.

Mais vim vérifie la syntaxe avant d'écrire et sauvegarder, donc c'est un très bon éditeur pour ce genre de manipulation risquée.

4. Maintenant, on peut ajouter la commande à notre script de fin de session, et à chaque fermeture de session, 
les fichiers redeviennent accessibles à tous les utilisateurs du groupe.

Allez dans votre `/home/user1/.config/plasma-workspace/shutdown/cleanup_steam_symlink.sh` et ajoutez à la fin du script :

```
# Corriger les permissions du dossier partagé
sudo /usr/local/bin/chown-steam
echo "✔ Permissions corrigées pour /mnt/steam/SteamLibrary" >> /var/log/steam-shutdown.log
echo "Utilisateur actuel : $USER" >> /var/log/steam-shutdown.log

```

Et maintenant, à chaque fermeture de session de l'utilisateur `user1` les permissions seront modifiées pour tout le dossier partagé.

**Remarque** : Les lignes d'`echo` vont écrire dans un fichier log quel utilisateur a modifié les fichiers dernièrement.


5. faire de même pour les utilisateur s`user2` et`user3` : il n'y a plus qu'à éditer les scripts de sortie de session pour ces deux utilisateurs.
